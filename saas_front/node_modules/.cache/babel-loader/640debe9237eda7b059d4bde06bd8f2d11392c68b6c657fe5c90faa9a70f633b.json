{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport axios from \"axios\";\nimport dayjs from \"dayjs\";\nimport '@fortawesome/fontawesome-free/css/all.css';\nimport { Row } from \"element-ui\";\nimport { Message } from 'element-ui';\nexport default {\n  data() {\n    return {\n      text: '付',\n      summary: '工资',\n      salaryID: '',\n      list: [],\n      // 分页相关\n      pageno: 1,\n      pagesize: 5,\n      total: 0,\n      // 搜索条件\n      bookID: '',\n      adminId: '',\n      time1: '',\n      time2: '',\n      phone: '',\n      userFormData: {\n        adminId: 0,\n        basicSalary: 0.00,\n        allowance: 0.00,\n        bonus: 0.00,\n        deduction: 0.00,\n        deductionDescription: ''\n      },\n      employeeID: '',\n      actionType: '',\n      salaryID: '',\n      dialogFormVisible: false,\n      employeeList: [],\n      selectedEmployee: '',\n      pickerOptions: {\n        shortcuts: [{\n          text: '最近一周',\n          onClick(picker) {\n            const end = new Date();\n            const start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近一个月',\n          onClick(picker) {\n            const end = new Date();\n            const start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近三个月',\n          onClick(picker) {\n            const end = new Date();\n            const start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);\n            picker.$emit('pick', [start, end]);\n          }\n        }]\n      },\n      value1: [new Date(2000, 10, 10, 10, 10), new Date(2000, 10, 11, 10, 10)],\n      value2: ''\n    };\n  },\n  created() {\n    this.bookID = localStorage.getItem('bookID');\n    this.getList();\n  },\n  methods: {\n    async updateApprovalStatus(row) {\n      console.log(row);\n      const res = await axios({\n        url: \"http://localhost:8081/salary/updateStatus\",\n        method: \"get\",\n        params: {\n          id: row.id\n        }\n      });\n      // this.getList()\n      localStorage.setItem('summary', this.summary);\n      localStorage.setItem('debitAmount', row.zg);\n      localStorage.setItem('text', this.text);\n      // 等待两秒后跳转页面\n      Message.success('即将进入凭证界面');\n      setTimeout(() => {\n        // 跳转页面\n        this.$router.push('/voucher/Voucher?type=1');\n      }, 1000);\n    },\n    async submitExport() {\n      try {\n        const res = await axios({\n          url: \"http://localhost:8081/salary/export\",\n          method: \"get\",\n          responseType: 'blob',\n          // 告诉axios我们期望接收一个blob\n          params: {\n            bookID: this.bookID,\n            adminId: this.adminId,\n            time1: this.value2[0],\n            time2: this.value2[1],\n            phone: this.phone\n          }\n        });\n\n        // 创建一个blob链接\n        const url = window.URL.createObjectURL(new Blob([res.data]));\n\n        // 创建一个a标签\n        const link = document.createElement('a');\n        link.href = url;\n        // 如果你想指定文件名，可以设置download属性\n        link.setAttribute('download', 'salary_export.csv'); // 假设导出的是CSV文件\n\n        // 触发点击\n        document.body.appendChild(link); // 需要添加到DOM中才能触发点击\n        link.click();\n\n        // 然后移除a标签\n        document.body.removeChild(link);\n      } catch (error) {\n        console.error('导出失败:', error);\n        // 可以在这里处理错误，比如显示一个错误消息\n      }\n    },\n    async getList() {\n      // const formattedParams = {\n      //     ...this.params,\n      //     assetName: this.params.assetName ? dayjs(this.params.assetName).format('YYYY-MM-DD HH:mm:ss') : null,\n      //     brandModel: this.params.brandModel ? dayjs(this.params.brandModel).format('YYYY-MM-DD HH:mm:ss') : null,\n      // };\n      const res = await axios({\n        method: \"get\",\n        url: \"http://localhost:8081/salary/list\",\n        params: {\n          page: this.pageno,\n          limit: this.pagesize,\n          bookID: this.bookID,\n          adminId: this.adminId,\n          time1: this.value2[0],\n          time2: this.value2[1],\n          phone: this.phone\n        }\n      });\n      // 修改日期格式\n      this.list = res.data.data.map(item => {\n        return {\n          ...item,\n          // 其他字段...\n          created: dayjs(item.created).format('YYYY-MM-DD HH:mm:ss')\n        };\n      });\n      /* console.log(this.list) */\n      this.total = res.data.count;\n    },\n    // 点击搜索\n    search() {\n      this.getList();\n    },\n    // 页码改变\n    pagechange(pageno) {\n      // 条件改变\n      this.pageno = pageno;\n      // 重新请求数据\n      this.getList();\n    },\n    // 打开新增弹窗，\n    addOpen() {\n      // 打开弹窗\n      this.dialogFormVisible = true;\n      // 记录状态\n      this.actionType = 'add';\n      this.userFormData = {\n        basicSalary: 0.00,\n        allowance: 0.00,\n        bonus: 0.00,\n        deduction: 0.00,\n        deductionDescription: ''\n      };\n    },\n    //修改弹窗\n    edit(row) {\n      // 打开弹窗\n      this.dialogFormVisible = true;\n      // 数据回显\n      this.userFormData.baseSalary = row.baseSalary;\n      this.userFormData.allowance = row.allowance;\n      this.userFormData.bonus = row.bonus;\n      this.userFormData.subsidy = row.subsidy;\n      this.userFormData.deduction = row.deduction;\n      this.userFormData.personalIncomeTax = row.personalIncomeTax;\n      this.userFormData.actualSalary = row.actualSalary;\n      this.userFormData.insurance = row.insurance;\n      this.selectedEmployee = row.employee.employeeID;\n      // 记录id\n      this.salaryID = row.salaryID;\n      this.employeeID = this.selectedEmployee;\n      console.log(this.salaryID);\n      console.log(row);\n      // 记录动作\n      this.actionType = 'edit';\n    },\n    calculatePersonalIncomeTax() {\n      /* console.log('计算工资') */\n      // 先从 userFormData 中获取其他输入项的值\n\n      const {\n        baseSalary,\n        allowance,\n        bonus,\n        subsidy,\n        deduction,\n        insurance\n      } = this.userFormData;\n\n      // 计算总收入\n      const totalIncome = baseSalary + allowance + bonus + subsidy - deduction;\n\n      // 计算税前应纳税额\n      const taxableIncome = totalIncome - 5000;\n\n      // 根据不同的情况计算 personalIncomeTax\n      if (taxableIncome > 0 && taxableIncome <= 5000) {\n        this.userFormData.personalIncomeTax = taxableIncome * 0;\n      } else if (taxableIncome > 5000 && taxableIncome <= 8000) {\n        this.userFormData.personalIncomeTax = taxableIncome * 0.03;\n      } else if (taxableIncome > 8000 && taxableIncome <= 17000) {\n        this.userFormData.personalIncomeTax = parseFloat((taxableIncome * 0.1).toFixed(2));\n      } else if (taxableIncome > 17000) {\n        this.userFormData.personalIncomeTax = taxableIncome * 0.2;\n      } /* \r\n        console.log(this.userFormData, '______'); */\n      const actualSalary = totalIncome - this.userFormData.personalIncomeTax - insurance;\n      this.userFormData.actualSalary = actualSalary;\n    },\n    async deleteSalary(id) {\n      const data = {\n        salaryID: id\n      };\n      const res = await axios({\n        url: '/deleteSalary',\n        method: 'post',\n        data: data\n      });\n      this.getList();\n    },\n    async submit() {\n      const data = {\n        ...this.userFormData,\n        bookID: this.bookID\n      };\n      data.employeeID = this.selectedEmployee;\n      if (this.actionType === 'edit') {\n        data.salaryID = this.salaryID;\n      }\n      const res = await axios({\n        url: 'http://localhost:8081/salary/add',\n        method: 'post',\n        data: data\n      });\n      if (res.data.code == 0) {\n        this.dialogFormVisible = false;\n        this.getList();\n      }\n      if (res.data.code == 20020) {\n        this.$message.error('该员工不存在');\n      }\n    }\n  },\n  watch: {\n    userFormData: {\n      handler() {\n        /* console.log('数据发生变化了！！！') */\n        this.calculatePersonalIncomeTax();\n      },\n      deep: true\n    }\n  }\n};","map":{"version":3,"names":["axios","dayjs","Row","Message","data","text","summary","salaryID","list","pageno","pagesize","total","bookID","adminId","time1","time2","phone","userFormData","basicSalary","allowance","bonus","deduction","deductionDescription","employeeID","actionType","dialogFormVisible","employeeList","selectedEmployee","pickerOptions","shortcuts","onClick","picker","end","Date","start","setTime","getTime","$emit","value1","value2","created","localStorage","getItem","getList","methods","updateApprovalStatus","row","console","log","res","url","method","params","id","setItem","zg","success","setTimeout","$router","push","submitExport","responseType","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","removeChild","error","page","limit","map","item","format","count","search","pagechange","addOpen","edit","baseSalary","subsidy","personalIncomeTax","actualSalary","insurance","employee","calculatePersonalIncomeTax","totalIncome","taxableIncome","parseFloat","toFixed","deleteSalary","submit","code","$message","watch","handler","deep"],"sources":["src/views/salary/Salary.vue"],"sourcesContent":["<template>\r\n    <div style=\"height: auto; width: auto;\">\r\n\r\n        <!-- 搜素和新增区域 -->\r\n        <el-card>\r\n            <div>\r\n                <el-row :gutter=\"20\">\r\n                    <!-- 搜索区域 -->\r\n                    <el-col :span=\"23\">\r\n                        <el-form :inline=\"true\" style=\"margin-top: 20px;\">\r\n                            <el-form-item label=\"员工编号\">\r\n                                <el-input v-model=\"adminId\" placeholder=\"请输入员工编号\"></el-input>\r\n                            </el-form-item>\r\n                            <el-form-item label=\"员工电话\">\r\n                                <el-input v-model=\"phone\" placeholder=\"请输入员工电话\"></el-input>\r\n                            </el-form-item>\r\n                            <el-form-item>\r\n                                <el-date-picker v-model=\"value2\" type=\"datetimerange\" :picker-options=\"pickerOptions\"\r\n                                    range-separator=\"至\" start-placeholder=\"开始日期\" end-placeholder=\"结束日期\" align=\"right\">\r\n                                </el-date-picker>\r\n                            </el-form-item>\r\n                            <el-form-item>\r\n                                <el-button @click=\"search()\" type=\"primary\" icon=\"el-icon-search\">搜索</el-button>\r\n                            </el-form-item>\r\n                            <el-button type=\"primary\" @click=\"addOpen\"><i\r\n                                    class=\"el-icon-circle-plus-outline el-icon--left\"></i>新增员工工资信息\r\n                            </el-button>\r\n                        </el-form>\r\n                    </el-col>\r\n                    <el-col :span=\"1\">\r\n                        <el-popover placement=\"top-start\" title=\"工资与保险的介绍\" width=\"200\" trigger=\"hover\" content=\"实际工资=基本工资\r\n                        +奖金+津贴-扣款-个人所得税-五险一金\">\r\n                            <i class=\"el-icon-info\" style=\"font-size: 24px; margin-top: 25px;\" slot=\"reference\"></i>\r\n                        </el-popover>\r\n\r\n\r\n                    </el-col>\r\n                </el-row>\r\n            </div>\r\n            <div>\r\n                <el-input type=\"file\" id=\"fileInput\" accept=\".xlsx, .csv\" />\r\n                <el-button size=\"max\" type=\"primary\" @click=\"submitUpload\">导入工资</el-button>\r\n                <el-button size=\"max\" type=\"success\" @click=\"submitExport\">导出工资</el-button>\r\n            </div>\r\n        </el-card>\r\n\r\n        <!-- 员工工资表 -->\r\n        <el-card style=\"margin-top: 20px;\">\r\n\r\n            <el-card>\r\n                <span style=\"font-size: 16px;font-weight: bold;\">员工工资表</span>\r\n            </el-card>\r\n\r\n            <el-table :data=\"list\" border style=\"width: 100%\">\r\n                <!-- <el-table-column prop=\"id\"  label=\"编号\" align=\"center\" > </el-table-column> -->\r\n                <el-table-column prop=\"name\" label=\"姓名\" width=\"70\" align=\"center\" fixed=\"left\"></el-table-column>\r\n                <el-table-column prop=\"phone\" label=\"电话\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"basicSalary\" label=\"基本工资\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"allowance\" label=\"津贴\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"bonus\" label=\"奖金\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"gx\" label=\"工资小计\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"deduction\" label=\"扣款\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"deductionDescription\" label=\"扣款原因\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"yg\" label=\"应发工资\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"individualIncomeTax\" label=\"个人免税额\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"gs\" label=\"个人所得税\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"sp\" label=\"社保公积金\" align=\"center\"> </el-table-column>\r\n                <el-table-column prop=\"zg\" label=\"实发工资\" align=\"center\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"created\" label=\"发放日期\" align=\"center\">\r\n                    <template #default=\"{ row }\">\r\n                        <div>\r\n                            <i class=\"el-icon-time \"></i> {{ row.created }}\r\n                        </div>\r\n                    </template>\r\n                </el-table-column>\r\n\r\n                <el-table-column fixed=\"right\" label=\"生成凭证\" align=\"center\">\r\n                    <template #default=\"{ row }\">\r\n                        <el-button v-if=\"row.voucherState === 0\" type=\"text\" size=\"medium\" icon=\"el-icon-document\"\r\n                            @click=\"updateApprovalStatus(row)\">生成凭证</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n\r\n            <!-- 分页组件 -->\r\n            <el-pagination @current-change=\"pagechange\" background layout=\"prev, pager, next\" :total=\"total\"\r\n                :page-size=\"pagesize\" style=\"text-align: center; margin-top: 10px;\">\r\n            </el-pagination>\r\n        </el-card>\r\n\r\n        <!-- 弹窗区域 -->\r\n        <el-dialog :title=\"actionType == 'add' ? '新增员工工资信息' : '编辑员工工资信息'\" :visible.sync=\"dialogFormVisible\"\r\n            width=\"700px\" style=\"font-size: 24px;\">\r\n\r\n\r\n            <el-form :model=\"userFormData\" class=\"demo-form-inline\" label-width=\"100px\">\r\n\r\n                <!-- 第一行 -->\r\n                <el-form-item label=\"工号\">\r\n                    <!-- <el-select v-model=\"selectedEmployee\" placeholder=\"选择员工\" clearable :disabled=\"actionType === 'edit'\"\r\n                        size=\"medium\">\r\n                        <el-option :label=\"employee.employeeDes\" :value=\"employee.employeeID\" :key=\"employee.employeeID\"\r\n                            v-for=\"employee in employeeList\" />\r\n                    </el-select> -->\r\n                    <el-input v-model=\"userFormData.adminId\" placeholder=\"员工编号\" controls-position=\"right\"\r\n                        style=\"width: 200px;\"></el-input>\r\n                </el-form-item>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"基本工资\">\r\n                            <el-input-number v-model=\"userFormData.basicSalary\" placeholder=\"基本工资\"\r\n                                controls-position=\"right\" size=\"medium\"></el-input-number>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n\r\n                <!-- 第二行 -->\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"奖金\">\r\n                            <el-input-number v-model=\"userFormData.bonus\" placeholder=\"奖金\" controls-position=\"right\"\r\n                                size=\"medium\">\r\n                            </el-input-number>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"津贴\">\r\n                            <el-input-number v-model=\"userFormData.allowance\" placeholder=\"津贴\" controls-position=\"right\"\r\n                                size=\"medium\"></el-input-number>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <!-- <el-col :span=\"12\">\r\n                        <el-form-item label=\"补助\">\r\n                            <el-input-number v-model=\"userFormData.subsidy\" placeholder=\"补助\" controls-position=\"right\"\r\n                                size=\"medium\"></el-input-number>\r\n                        </el-form-item>\r\n                    </el-col> -->\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"扣款\">\r\n                            <el-input-number v-model=\"userFormData.deduction\" placeholder=\"扣款\" controls-position=\"right\"\r\n                                size=\"medium\"></el-input-number>\r\n                        </el-form-item>\r\n                    </el-col>\r\n\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"扣款原因\">\r\n                            <el-input v-model=\"userFormData.deductionDescription\" placeholder=\"扣款原因\"\r\n                                controls-position=\"right\" style=\"width: 400px;\"></el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <!-- <el-col :span=\"12\">\r\n                        <el-form-item label=\"保险金额\">\r\n                            <el-input-number disabled v-model=\"userFormData.insurance\" placeholder=\"保险金额\"\r\n                                controls-position=\"right\" size=\"medium\"></el-input-number>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"实发工资\">\r\n                            <el-input-number disabled v-model=\"userFormData.actualSalary\" placeholder=\"实发工资\"\r\n                                controls-position=\"right\" size=\"medium\"></el-input-number>\r\n                        </el-form-item>\r\n                    </el-col> -->\r\n                </el-row>\r\n\r\n                <el-form-item>\r\n                    <el-button @click=\"submit\" style=\"width: 180px; margin-left: 110px\" type=\"primary\">提交<i\r\n                            class=\"el-icon-success el-icon--right\"></i></el-button>\r\n                </el-form-item>\r\n\r\n            </el-form>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport axios from \"axios\";\r\nimport dayjs from \"dayjs\";\r\nimport '@fortawesome/fontawesome-free/css/all.css';\r\nimport { Row } from \"element-ui\";\r\nimport { Message } from 'element-ui'\r\nexport default {\r\n\r\n    data() {\r\n        return {\r\n            text: '付',\r\n            summary: '工资',\r\n            salaryID: '',\r\n            list: [],\r\n            // 分页相关\r\n            pageno: 1,\r\n            pagesize: 5,\r\n            total: 0,\r\n            // 搜索条件\r\n            bookID: '',\r\n            adminId: '',\r\n            time1: '',\r\n            time2: '',\r\n            phone: '',\r\n            userFormData: {\r\n                adminId: 0,\r\n                basicSalary: 0.00,\r\n                allowance: 0.00,\r\n                bonus: 0.00,\r\n                deduction: 0.00,\r\n                deductionDescription: ''\r\n            },\r\n            employeeID: '',\r\n            actionType: '',\r\n            salaryID: '',\r\n            dialogFormVisible: false,\r\n            employeeList: [],\r\n            selectedEmployee: '',\r\n\r\n            pickerOptions: {\r\n                shortcuts: [{\r\n                    text: '最近一周',\r\n                    onClick(picker) {\r\n                        const end = new Date();\r\n                        const start = new Date();\r\n                        start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);\r\n                        picker.$emit('pick', [start, end]);\r\n                    }\r\n                }, {\r\n                    text: '最近一个月',\r\n                    onClick(picker) {\r\n                        const end = new Date();\r\n                        const start = new Date();\r\n                        start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);\r\n                        picker.$emit('pick', [start, end]);\r\n                    }\r\n                }, {\r\n                    text: '最近三个月',\r\n                    onClick(picker) {\r\n                        const end = new Date();\r\n                        const start = new Date();\r\n                        start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);\r\n                        picker.$emit('pick', [start, end]);\r\n                    }\r\n                }]\r\n            },\r\n            value1: [new Date(2000, 10, 10, 10, 10), new Date(2000, 10, 11, 10, 10)],\r\n            value2: ''\r\n        };\r\n    },\r\n    created() {\r\n        this.bookID = localStorage.getItem('bookID');\r\n        this.getList()\r\n    },\r\n    methods: {\r\n        async updateApprovalStatus(row) {\r\n            console.log(row)\r\n            const res = await axios({\r\n                url: \"http://localhost:8081/salary/updateStatus\",\r\n                method: \"get\",\r\n                params: {\r\n                    id: row.id\r\n                }\r\n            })\r\n            // this.getList()\r\n            localStorage.setItem('summary', this.summary)\r\n            localStorage.setItem('debitAmount', row.zg)\r\n            localStorage.setItem('text', this.text)\r\n            // 等待两秒后跳转页面\r\n            Message.success('即将进入凭证界面')\r\n            setTimeout(() => {\r\n                // 跳转页面\r\n                this.$router.push('/voucher/Voucher?type=1');\r\n            }, 1000);\r\n        },\r\n        async submitExport() {\r\n            try {\r\n                const res = await axios({\r\n                    url: \"http://localhost:8081/salary/export\",\r\n                    method: \"get\",\r\n                    responseType: 'blob', // 告诉axios我们期望接收一个blob\r\n                    params: {\r\n                        bookID: this.bookID,\r\n                        adminId: this.adminId,\r\n                        time1: this.value2[0],\r\n                        time2: this.value2[1],\r\n                        phone: this.phone\r\n                    }\r\n                });\r\n\r\n                // 创建一个blob链接\r\n                const url = window.URL.createObjectURL(new Blob([res.data]));\r\n\r\n                // 创建一个a标签\r\n                const link = document.createElement('a');\r\n                link.href = url;\r\n                // 如果你想指定文件名，可以设置download属性\r\n                link.setAttribute('download', 'salary_export.csv'); // 假设导出的是CSV文件\r\n\r\n                // 触发点击\r\n                document.body.appendChild(link); // 需要添加到DOM中才能触发点击\r\n                link.click();\r\n\r\n                // 然后移除a标签\r\n                document.body.removeChild(link);\r\n\r\n            } catch (error) {\r\n                console.error('导出失败:', error);\r\n                // 可以在这里处理错误，比如显示一个错误消息\r\n            }\r\n        },\r\n\r\n        async getList() {\r\n            // const formattedParams = {\r\n            //     ...this.params,\r\n            //     assetName: this.params.assetName ? dayjs(this.params.assetName).format('YYYY-MM-DD HH:mm:ss') : null,\r\n            //     brandModel: this.params.brandModel ? dayjs(this.params.brandModel).format('YYYY-MM-DD HH:mm:ss') : null,\r\n            // };\r\n            const res = await axios({\r\n                method: \"get\",\r\n                url: \"http://localhost:8081/salary/list\",\r\n                params: {\r\n                    page: this.pageno,\r\n                    limit: this.pagesize,\r\n                    bookID: this.bookID,\r\n                    adminId: this.adminId,\r\n                    time1: this.value2[0],\r\n                    time2: this.value2[1],\r\n                    phone: this.phone\r\n                },\r\n            });\r\n            // 修改日期格式\r\n            this.list = res.data.data.map(item => {\r\n                return {\r\n                    ...item,\r\n                    // 其他字段...\r\n                    created: dayjs(item.created).format('YYYY-MM-DD HH:mm:ss')\r\n                };\r\n            });\r\n            /* console.log(this.list) */\r\n            this.total = res.data.count;\r\n\r\n\r\n        },\r\n        // 点击搜索\r\n        search() {\r\n            this.getList()\r\n        },\r\n\r\n        // 页码改变\r\n        pagechange(pageno) {\r\n            // 条件改变\r\n            this.pageno = pageno\r\n            // 重新请求数据\r\n            this.getList()\r\n        },\r\n        // 打开新增弹窗，\r\n        addOpen() {\r\n            // 打开弹窗\r\n            this.dialogFormVisible = true;\r\n            // 记录状态\r\n            this.actionType = 'add';\r\n            this.userFormData = {\r\n                basicSalary: 0.00,\r\n                allowance: 0.00,\r\n                bonus: 0.00,\r\n                deduction: 0.00,\r\n                deductionDescription: '',\r\n            };\r\n        },\r\n        //修改弹窗\r\n        edit(row) {\r\n            // 打开弹窗\r\n            this.dialogFormVisible = true\r\n            // 数据回显\r\n            this.userFormData.baseSalary = row.baseSalary\r\n            this.userFormData.allowance = row.allowance\r\n            this.userFormData.bonus = row.bonus\r\n            this.userFormData.subsidy = row.subsidy\r\n            this.userFormData.deduction = row.deduction\r\n            this.userFormData.personalIncomeTax = row.personalIncomeTax\r\n            this.userFormData.actualSalary = row.actualSalary\r\n            this.userFormData.insurance = row.insurance\r\n            this.selectedEmployee = row.employee.employeeID\r\n            // 记录id\r\n            this.salaryID = row.salaryID\r\n            this.employeeID = this.selectedEmployee\r\n            console.log(this.salaryID)\r\n            console.log(row)\r\n            // 记录动作\r\n            this.actionType = 'edit'\r\n        },\r\n\r\n        calculatePersonalIncomeTax() {\r\n            /* console.log('计算工资') */\r\n            // 先从 userFormData 中获取其他输入项的值\r\n\r\n            const { baseSalary, allowance, bonus, subsidy, deduction, insurance } = this.userFormData;\r\n\r\n            // 计算总收入\r\n            const totalIncome = baseSalary + allowance + bonus + subsidy - deduction;\r\n\r\n            // 计算税前应纳税额\r\n            const taxableIncome = totalIncome - 5000;\r\n\r\n            // 根据不同的情况计算 personalIncomeTax\r\n            if (taxableIncome > 0 && taxableIncome <= 5000) {\r\n                this.userFormData.personalIncomeTax = taxableIncome * 0;\r\n            } else if (taxableIncome > 5000 && taxableIncome <= 8000) {\r\n                this.userFormData.personalIncomeTax = taxableIncome * 0.03;\r\n            } else if (taxableIncome > 8000 && taxableIncome <= 17000) {\r\n                this.userFormData.personalIncomeTax = parseFloat((taxableIncome * 0.1).toFixed(2));\r\n            } else if (taxableIncome > 17000) {\r\n                this.userFormData.personalIncomeTax = taxableIncome * 0.2;\r\n            }/* \r\n            console.log(this.userFormData, '______'); */\r\n            const actualSalary = totalIncome - this.userFormData.personalIncomeTax - insurance;\r\n            this.userFormData.actualSalary = actualSalary\r\n        },\r\n        async deleteSalary(id) {\r\n            const data = {\r\n                salaryID: id\r\n            }\r\n            const res = await axios({\r\n                url: '/deleteSalary',\r\n                method: 'post',\r\n                data: data\r\n            })\r\n            this.getList()\r\n        },\r\n\r\n        async submit() {\r\n            const data = {\r\n                ...this.userFormData,\r\n                bookID: this.bookID,\r\n            }\r\n            data.employeeID = this.selectedEmployee;\r\n            if (this.actionType === 'edit') {\r\n                data.salaryID = this.salaryID\r\n            }\r\n            const res = await axios({\r\n                url: 'http://localhost:8081/salary/add',\r\n                method: 'post',\r\n                data: data\r\n            })\r\n            if (res.data.code == 0) {\r\n                this.dialogFormVisible = false\r\n                this.getList()\r\n            }\r\n            if (res.data.code == 20020) {\r\n                this.$message.error('该员工不存在');\r\n            }\r\n        }\r\n    },\r\n    watch: {\r\n        userFormData: {\r\n            handler() {\r\n                /* console.log('数据发生变化了！！！') */\r\n                this.calculatePersonalIncomeTax()\r\n            },\r\n            deep: true\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.row-box {\r\n    width: 100%;\r\n    display: flex;\r\n    margin-top: 20px;\r\n    margin-bottom: 8px;\r\n    justify-content: center;\r\n}\r\n</style>"],"mappings":";;;;AAqLA,OAAAA,KAAA;AACA,OAAAC,KAAA;AACA;AACA,SAAAC,GAAA;AACA,SAAAC,OAAA;AACA;EAEAC,KAAA;IACA;MACAC,IAAA;MACAC,OAAA;MACAC,QAAA;MACAC,IAAA;MACA;MACAC,MAAA;MACAC,QAAA;MACAC,KAAA;MACA;MACAC,MAAA;MACAC,OAAA;MACAC,KAAA;MACAC,KAAA;MACAC,KAAA;MACAC,YAAA;QACAJ,OAAA;QACAK,WAAA;QACAC,SAAA;QACAC,KAAA;QACAC,SAAA;QACAC,oBAAA;MACA;MACAC,UAAA;MACAC,UAAA;MACAjB,QAAA;MACAkB,iBAAA;MACAC,YAAA;MACAC,gBAAA;MAEAC,aAAA;QACAC,SAAA;UACAxB,IAAA;UACAyB,QAAAC,MAAA;YACA,MAAAC,GAAA,OAAAC,IAAA;YACA,MAAAC,KAAA,OAAAD,IAAA;YACAC,KAAA,CAAAC,OAAA,CAAAD,KAAA,CAAAE,OAAA;YACAL,MAAA,CAAAM,KAAA,UAAAH,KAAA,EAAAF,GAAA;UACA;QACA;UACA3B,IAAA;UACAyB,QAAAC,MAAA;YACA,MAAAC,GAAA,OAAAC,IAAA;YACA,MAAAC,KAAA,OAAAD,IAAA;YACAC,KAAA,CAAAC,OAAA,CAAAD,KAAA,CAAAE,OAAA;YACAL,MAAA,CAAAM,KAAA,UAAAH,KAAA,EAAAF,GAAA;UACA;QACA;UACA3B,IAAA;UACAyB,QAAAC,MAAA;YACA,MAAAC,GAAA,OAAAC,IAAA;YACA,MAAAC,KAAA,OAAAD,IAAA;YACAC,KAAA,CAAAC,OAAA,CAAAD,KAAA,CAAAE,OAAA;YACAL,MAAA,CAAAM,KAAA,UAAAH,KAAA,EAAAF,GAAA;UACA;QACA;MACA;MACAM,MAAA,OAAAL,IAAA,4BAAAA,IAAA;MACAM,MAAA;IACA;EACA;EACAC,QAAA;IACA,KAAA5B,MAAA,GAAA6B,YAAA,CAAAC,OAAA;IACA,KAAAC,OAAA;EACA;EACAC,OAAA;IACA,MAAAC,qBAAAC,GAAA;MACAC,OAAA,CAAAC,GAAA,CAAAF,GAAA;MACA,MAAAG,GAAA,SAAAjD,KAAA;QACAkD,GAAA;QACAC,MAAA;QACAC,MAAA;UACAC,EAAA,EAAAP,GAAA,CAAAO;QACA;MACA;MACA;MACAZ,YAAA,CAAAa,OAAA,iBAAAhD,OAAA;MACAmC,YAAA,CAAAa,OAAA,gBAAAR,GAAA,CAAAS,EAAA;MACAd,YAAA,CAAAa,OAAA,cAAAjD,IAAA;MACA;MACAF,OAAA,CAAAqD,OAAA;MACAC,UAAA;QACA;QACA,KAAAC,OAAA,CAAAC,IAAA;MACA;IACA;IACA,MAAAC,aAAA;MACA;QACA,MAAAX,GAAA,SAAAjD,KAAA;UACAkD,GAAA;UACAC,MAAA;UACAU,YAAA;UAAA;UACAT,MAAA;YACAxC,MAAA,OAAAA,MAAA;YACAC,OAAA,OAAAA,OAAA;YACAC,KAAA,OAAAyB,MAAA;YACAxB,KAAA,OAAAwB,MAAA;YACAvB,KAAA,OAAAA;UACA;QACA;;QAEA;QACA,MAAAkC,GAAA,GAAAY,MAAA,CAAAC,GAAA,CAAAC,eAAA,KAAAC,IAAA,EAAAhB,GAAA,CAAA7C,IAAA;;QAEA;QACA,MAAA8D,IAAA,GAAAC,QAAA,CAAAC,aAAA;QACAF,IAAA,CAAAG,IAAA,GAAAnB,GAAA;QACA;QACAgB,IAAA,CAAAI,YAAA;;QAEA;QACAH,QAAA,CAAAI,IAAA,CAAAC,WAAA,CAAAN,IAAA;QACAA,IAAA,CAAAO,KAAA;;QAEA;QACAN,QAAA,CAAAI,IAAA,CAAAG,WAAA,CAAAR,IAAA;MAEA,SAAAS,KAAA;QACA5B,OAAA,CAAA4B,KAAA,UAAAA,KAAA;QACA;MACA;IACA;IAEA,MAAAhC,QAAA;MACA;MACA;MACA;MACA;MACA;MACA,MAAAM,GAAA,SAAAjD,KAAA;QACAmD,MAAA;QACAD,GAAA;QACAE,MAAA;UACAwB,IAAA,OAAAnE,MAAA;UACAoE,KAAA,OAAAnE,QAAA;UACAE,MAAA,OAAAA,MAAA;UACAC,OAAA,OAAAA,OAAA;UACAC,KAAA,OAAAyB,MAAA;UACAxB,KAAA,OAAAwB,MAAA;UACAvB,KAAA,OAAAA;QACA;MACA;MACA;MACA,KAAAR,IAAA,GAAAyC,GAAA,CAAA7C,IAAA,CAAAA,IAAA,CAAA0E,GAAA,CAAAC,IAAA;QACA;UACA,GAAAA,IAAA;UACA;UACAvC,OAAA,EAAAvC,KAAA,CAAA8E,IAAA,CAAAvC,OAAA,EAAAwC,MAAA;QACA;MACA;MACA;MACA,KAAArE,KAAA,GAAAsC,GAAA,CAAA7C,IAAA,CAAA6E,KAAA;IAGA;IACA;IACAC,OAAA;MACA,KAAAvC,OAAA;IACA;IAEA;IACAwC,WAAA1E,MAAA;MACA;MACA,KAAAA,MAAA,GAAAA,MAAA;MACA;MACA,KAAAkC,OAAA;IACA;IACA;IACAyC,QAAA;MACA;MACA,KAAA3D,iBAAA;MACA;MACA,KAAAD,UAAA;MACA,KAAAP,YAAA;QACAC,WAAA;QACAC,SAAA;QACAC,KAAA;QACAC,SAAA;QACAC,oBAAA;MACA;IACA;IACA;IACA+D,KAAAvC,GAAA;MACA;MACA,KAAArB,iBAAA;MACA;MACA,KAAAR,YAAA,CAAAqE,UAAA,GAAAxC,GAAA,CAAAwC,UAAA;MACA,KAAArE,YAAA,CAAAE,SAAA,GAAA2B,GAAA,CAAA3B,SAAA;MACA,KAAAF,YAAA,CAAAG,KAAA,GAAA0B,GAAA,CAAA1B,KAAA;MACA,KAAAH,YAAA,CAAAsE,OAAA,GAAAzC,GAAA,CAAAyC,OAAA;MACA,KAAAtE,YAAA,CAAAI,SAAA,GAAAyB,GAAA,CAAAzB,SAAA;MACA,KAAAJ,YAAA,CAAAuE,iBAAA,GAAA1C,GAAA,CAAA0C,iBAAA;MACA,KAAAvE,YAAA,CAAAwE,YAAA,GAAA3C,GAAA,CAAA2C,YAAA;MACA,KAAAxE,YAAA,CAAAyE,SAAA,GAAA5C,GAAA,CAAA4C,SAAA;MACA,KAAA/D,gBAAA,GAAAmB,GAAA,CAAA6C,QAAA,CAAApE,UAAA;MACA;MACA,KAAAhB,QAAA,GAAAuC,GAAA,CAAAvC,QAAA;MACA,KAAAgB,UAAA,QAAAI,gBAAA;MACAoB,OAAA,CAAAC,GAAA,MAAAzC,QAAA;MACAwC,OAAA,CAAAC,GAAA,CAAAF,GAAA;MACA;MACA,KAAAtB,UAAA;IACA;IAEAoE,2BAAA;MACA;MACA;;MAEA;QAAAN,UAAA;QAAAnE,SAAA;QAAAC,KAAA;QAAAmE,OAAA;QAAAlE,SAAA;QAAAqE;MAAA,SAAAzE,YAAA;;MAEA;MACA,MAAA4E,WAAA,GAAAP,UAAA,GAAAnE,SAAA,GAAAC,KAAA,GAAAmE,OAAA,GAAAlE,SAAA;;MAEA;MACA,MAAAyE,aAAA,GAAAD,WAAA;;MAEA;MACA,IAAAC,aAAA,QAAAA,aAAA;QACA,KAAA7E,YAAA,CAAAuE,iBAAA,GAAAM,aAAA;MACA,WAAAA,aAAA,WAAAA,aAAA;QACA,KAAA7E,YAAA,CAAAuE,iBAAA,GAAAM,aAAA;MACA,WAAAA,aAAA,WAAAA,aAAA;QACA,KAAA7E,YAAA,CAAAuE,iBAAA,GAAAO,UAAA,EAAAD,aAAA,QAAAE,OAAA;MACA,WAAAF,aAAA;QACA,KAAA7E,YAAA,CAAAuE,iBAAA,GAAAM,aAAA;MACA;AACA;MACA,MAAAL,YAAA,GAAAI,WAAA,QAAA5E,YAAA,CAAAuE,iBAAA,GAAAE,SAAA;MACA,KAAAzE,YAAA,CAAAwE,YAAA,GAAAA,YAAA;IACA;IACA,MAAAQ,aAAA5C,EAAA;MACA,MAAAjD,IAAA;QACAG,QAAA,EAAA8C;MACA;MACA,MAAAJ,GAAA,SAAAjD,KAAA;QACAkD,GAAA;QACAC,MAAA;QACA/C,IAAA,EAAAA;MACA;MACA,KAAAuC,OAAA;IACA;IAEA,MAAAuD,OAAA;MACA,MAAA9F,IAAA;QACA,QAAAa,YAAA;QACAL,MAAA,OAAAA;MACA;MACAR,IAAA,CAAAmB,UAAA,QAAAI,gBAAA;MACA,SAAAH,UAAA;QACApB,IAAA,CAAAG,QAAA,QAAAA,QAAA;MACA;MACA,MAAA0C,GAAA,SAAAjD,KAAA;QACAkD,GAAA;QACAC,MAAA;QACA/C,IAAA,EAAAA;MACA;MACA,IAAA6C,GAAA,CAAA7C,IAAA,CAAA+F,IAAA;QACA,KAAA1E,iBAAA;QACA,KAAAkB,OAAA;MACA;MACA,IAAAM,GAAA,CAAA7C,IAAA,CAAA+F,IAAA;QACA,KAAAC,QAAA,CAAAzB,KAAA;MACA;IACA;EACA;EACA0B,KAAA;IACApF,YAAA;MACAqF,QAAA;QACA;QACA,KAAAV,0BAAA;MACA;MACAW,IAAA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}